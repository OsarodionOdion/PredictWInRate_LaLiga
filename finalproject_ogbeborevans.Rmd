---
title: "Final Project - Predicting Win Rates in La Liga"
author: "Osarodion"
date: "4/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libraries}
library(ggplot2)
library(dplyr)
library(corrplot)
library(skimr)
library(MLmetrics)

```



Advanced Business Analytics â€“ Final Project
===========================================

Team Members
------------
Osarodion Ogbebor Evans

Project Title
-------------
Predicting win rates for the 2017/2018 Spanish la liga season

Type of Final Project
---------------------
Type 1 - Analysis of a data set of interest

Executive Summary of the Proposed Project
-----------------------------------------

The Spanish la liga is often referred to as the most competitive football (soccer) league in the world. Home to the most successful football teams in Europe, the league is often considered the toughest. Winning the league requires acquiring the most points from all games played in the season. For every season, there is a total of 38 games for every team .i.e. 19 home games and 19 away games. For every team, a win earns 3 points, a draw earns 1 point and a loss earns 0 point.

With lesser goals scored and more goals conceded than the runner-up, Real Madrid was the crowned champion of the 2016-2017 la liga Season. 2017-2018 season was won by Barcelona with more goals scored and more goals conceded than the runner-up (Atletico Madrid). However, Real Madrid ended the season in 3rd place having scored 30 goals more than the runner-up, and 5 goals less than the season champion.

This project analyzes different match statistics and their effects on win rate. It covers the use of R in creating different predictive models, and their effect in predicting win rates for different seasons.

Data Source
-----------------------
The data required for this project is a table consisting of different statistics for every game of the 2016/2017 & 2017/2018 la liga primera division seasons. This data is extracted from [footystats](https://footystats.org/download-stats-csv)

```{r read_seasonsData}
#read csv file for the 2016/2017 season
laliga1617 <- read.csv("Data/spain-la-liga-teams-2016-to-2017-stats.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)

#Display the data sets and the data structure 
head(laliga1617)
tail(laliga1617)
str(laliga1617)
```

Data  Description and Selection
-------------------------------
The variables in the csv files represent game statistics and betting odds recorded for the season. The analysis and models for this project will be based only on the game statistics. Among the game statistics, the data for each variable has been broken down into home and away. For example columns 9 though 11 show wins, home wins and away wins, where wins = home wins + away wins.

```{r display_wins}
head(laliga1617[,9:11])
```

I will be reassigning only the whole variables for the game statistics to the laliga1617 data frame (i.e. excluding the betting odds and the home and away variables for most of the game statistics).

```{r game_stats_data}
laliga1617 <- laliga1617 %>% select(1,9,12,15,18,21,25,26,27,37,40,43,55,58,61,64,67,70,73,76,79,82,85,88,91)
head(laliga1617)
str(laliga1617)
```

The response variable for the predictive models will be season points. In soccer, a draw wins both teams 1 point, and a win earns the winning team 3 points. Therefore the season points is a sum of 3 x the number of games won and the number of games drawn

```{r win_rate}
#calculating win rate for each team.
laliga1617 <- laliga1617 %>%
  mutate(season_points = (3*wins)+draws)

```

Exploratory Data Analysis (EDA)
--------------------------
The EDA provides a summary of our data, and an investigation into the relationships between the variables.

```{r summary_stats}
summary(laliga1617)

```

The summary on the data set confirms the absence of missing variables.

```{r correlation_plot}
cormat <- cor(laliga1617[,2:26])
cormat
corrplot::corrplot(cormat, )

```

The correlation plot provides insights on the effect of other variables (excluding wins, draws and losses) on win rate. Scatter plots are provided for further exploration.

```{r scatter_plots}
g <- ggplot(laliga1617)
g + aes(x=goals_scored, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=goals_conceded, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=clean_sheets, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=corners_total, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=average_possession, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=shots_on_target, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=shots_off_target, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=goal_difference_half_time, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=leading_at_half_time, y=season_points)+geom_point()+geom_smooth(method = "lm")
g + aes(x=cards_total, y=season_points)+geom_point()+geom_smooth(method = "lm")
```

The shape of the confidence interval has been included in the scatter plots to aid with comprehending the variations. Contrary to the notion of Spanish football, where high ball possession is perceived as a principal contributor to winning games, it was interesting to see that average possession and total corner kicks with the thickest bands. Indicating both variables might have the least correlation among the plotted variables. (N.B. While correlation analysis can provide a summary of the relationship between variables, it can only determine direct relationship. In regression, we are seeking to determine how much the dependent variable changes given a change in the independent variable. i.e. "y" as a function of "x")

Model building & assessment
---------------------------
Two models would be considered in building the predictive models - the base model(null model) and the full model.

```{r models}
nullModel <- lm(season_points ~ 1, data = laliga1617)
fullModel <- lm(season_points ~ goals_scored + goals_conceded + clean_sheets + corners_total + average_possession+
                shots_on_target+shots_off_target+goal_difference_half_time+leading_at_half_time+cards_total,
                data = laliga1617)

```

```{r model_summary}
summary(nullModel)
summary(fullModel)
```

```{r residual_analysis}
plot(nullModel$residuals, col="blue")
plot(fullModel$residuals, col="green")
```

The null model provides a base comparison for the full model. It indicates an intercept of 53 season points. The full model has a high R-squared value and a low p-value which indicate the model fits well and is a good predictor of season points. The randomness presented by the residual plots support the R-squared value.

```{r MAE_values}
MAE_models <- c(MAE(laliga1617$season_points, nullModel$fitted.values),
                MAE(laliga1617$season_points, fullModel$fitted.values))

MAE_result <- data.frame(MAE_models[1],MAE_models[2])
names(MAE_result) <- c("nullModel","fullModel")
MAE_result
```
The value of the Mean Absolute Error (MAE) also qualifies the full model as a good predictor for season points

Dealing with Multi-colliearity
-------------------------------






